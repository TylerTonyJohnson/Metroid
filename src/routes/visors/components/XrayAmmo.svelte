<!-- LOGIC -->
<script>
	import { currentAmmo, maxAmmo } from '../../../lib/stores';
	import { AmmoState } from '../../../lib/enums';

	$: ammoPercent = ($currentAmmo / $maxAmmo) * 100;

	$: currentAmmoHundreds = Math.floor(($currentAmmo / 100) % 10);
	$: currentAmmoTens = Math.floor(($currentAmmo / 10) % 10);
	$: currentAmmoOnes = Math.floor(($currentAmmo / 1) % 10);
	$: maxAmmoHundreds = Math.floor(($maxAmmo / 100) % 10);
	$: maxAmmoTens = Math.floor(($maxAmmo / 10) % 10);
	$: maxAmmoOnes = Math.floor(($maxAmmo / 1) % 10);

	const lowAmmoThresh = 20; // Percent

	let status;
	let message;

	$: switch (true) {
		case ammoPercent === 100:
			status = AmmoState.Full;
			message = '';
			break;
		case ammoPercent > lowAmmoThresh:
			status = AmmoState.High;
			message = '';
			break;
		case ammoPercent > 0:
			status = AmmoState.Low;
			message = 'Missiles Low';
			break;
		case ammoPercent === 0:
			status = AmmoState.Empty;
			message = 'Depleted';
			break;
	}

	const ammoBarDegrees = 64;

	$: ammoRotation = -(ammoPercent / 100 - 1 / 2) * ammoBarDegrees;
</script>

<div id="frame">
	<div id="ammo-counter">
		<!-- Bar -->
		<svg id="bar" viewBox="0 0 87 450" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M76.9996 225C76.9996 303.751 54.5926 380.876 12.3958 447.368L3.95121 442.009C45.1312 377.12 66.9982 301.853 66.9981 225C66.9981 148.147 45.1311 72.8801 3.95117 7.99091L12.3957 2.63184C54.5926 69.1235 76.9996 146.249 76.9996 225Z"
				fill="url(#ammo-gradient)"
			/>
			<linearGradient id="ammo-gradient" x1="0%" x2="0%" y1="100%" y2="0%">
				<stop offset="{ammoPercent}%" stop-color="#A3E7F5" />
				<stop offset="0%" stop-color="#5999A680" />
			</linearGradient>
		</svg>
		<!-- Numbers -->
		<svg
			class="numbers-container"
			viewBox="0 0 90 108"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
		>
			<!-- Line -->
			<path
				class="line"
				class:empty-stroke={status === AmmoState.Empty}
				class:some-stroke={status !== AmmoState.Empty}
				d="M0 54L86 54"
			/>
			<!-- Numbers -->
			<g
				class="numbers"
				class:empty-fill={status === AmmoState.Empty}
				class:some-fill={status !== AmmoState.Empty}
			>
				<text x="15" y="32">{currentAmmoHundreds}</text>
				<text x="43" y="32">{currentAmmoTens}</text>
				<text x="71" y="32">{currentAmmoOnes}</text>
				<text x="15" y="88">{maxAmmoHundreds}</text>
				<text x="43" y="88">{maxAmmoTens}</text>
				<text x="71" y="88">{maxAmmoOnes}</text>
			</g>
			<!-- <path
				d="M23.3652 9.90234C24.5137 9.90234 25.4863 10.3008 26.2832 11.0977C27.0801 11.8945 27.4785 12.8555 27.4785 13.9805V38.5195C27.4785 39.6445 27.0801 40.6055 26.2832 41.4023C25.4863 42.1992 24.5137 42.5977 23.3652 42.5977H7.01758C5.89258 42.5977 4.93164 42.1992 4.13477 41.4023C3.33789 40.6055 2.93945 39.6445 2.93945 38.5195V13.9805C2.93945 12.8555 3.33789 11.8945 4.13477 11.0977C4.93164 10.3008 5.89258 9.90234 7.01758 9.90234H23.3652ZM8.63477 16.4414V36.0586C8.63477 36.293 8.7168 36.4922 8.88086 36.6562C9.04492 36.8203 9.24414 36.9023 9.47852 36.9023H20.9395C21.1504 36.9023 21.3379 36.8203 21.502 36.6562C21.666 36.4922 21.748 36.293 21.748 36.0586V16.4414C21.748 16.207 21.666 16.0078 21.502 15.8438C21.3379 15.6797 21.1504 15.5977 20.9395 15.5977H9.47852C9.24414 15.5977 9.04492 15.6797 8.88086 15.8438C8.7168 16.0078 8.63477 16.207 8.63477 16.4414ZM51.1738 9.90234C52.3223 9.90234 53.2949 10.3008 54.0918 11.0977C54.8887 11.8945 55.2871 12.8555 55.2871 13.9805V38.5195C55.2871 39.6445 54.8887 40.6055 54.0918 41.4023C53.2949 42.1992 52.3223 42.5977 51.1738 42.5977H34.8262C33.7012 42.5977 32.7402 42.1992 31.9434 41.4023C31.1465 40.6055 30.748 39.6445 30.748 38.5195V13.9805C30.748 12.8555 31.1465 11.8945 31.9434 11.0977C32.7402 10.3008 33.7012 9.90234 34.8262 9.90234H51.1738ZM36.4434 16.4414V36.0586C36.4434 36.293 36.5254 36.4922 36.6895 36.6562C36.8535 36.8203 37.0527 36.9023 37.2871 36.9023H48.748C48.959 36.9023 49.1465 36.8203 49.3105 36.6562C49.4746 36.4922 49.5566 36.293 49.5566 36.0586V16.4414C49.5566 16.207 49.4746 16.0078 49.3105 15.8438C49.1465 15.6797 48.959 15.5977 48.748 15.5977H37.2871C37.0527 15.5977 36.8535 15.6797 36.6895 15.8438C36.5254 16.0078 36.4434 16.207 36.4434 16.4414ZM78.9824 9.90234C80.1309 9.90234 81.1035 10.3008 81.9004 11.0977C82.6973 11.8945 83.0957 12.8555 83.0957 13.9805V38.5195C83.0957 39.6445 82.6973 40.6055 81.9004 41.4023C81.1035 42.1992 80.1309 42.5977 78.9824 42.5977H62.6348C61.5098 42.5977 60.5488 42.1992 59.752 41.4023C58.9551 40.6055 58.5566 39.6445 58.5566 38.5195V13.9805C58.5566 12.8555 58.9551 11.8945 59.752 11.0977C60.5488 10.3008 61.5098 9.90234 62.6348 9.90234H78.9824ZM64.252 16.4414V36.0586C64.252 36.293 64.334 36.4922 64.498 36.6562C64.6621 36.8203 64.8613 36.9023 65.0957 36.9023H76.5566C76.7676 36.9023 76.9551 36.8203 77.1191 36.6562C77.2832 36.4922 77.3652 36.293 77.3652 36.0586V16.4414C77.3652 16.207 77.2832 16.0078 77.1191 15.8438C76.9551 15.6797 76.7676 15.5977 76.5566 15.5977H65.0957C64.8613 15.5977 64.6621 15.6797 64.498 15.8438C64.334 16.0078 64.252 16.207 64.252 16.4414Z"
				fill="#456778"
			/>
			<path
				d="M23.3652 65.9023C24.5137 65.9023 25.4863 66.3008 26.2832 67.0977C27.0801 67.8945 27.4785 68.8555 27.4785 69.9805V94.5195C27.4785 95.6445 27.0801 96.6055 26.2832 97.4023C25.4863 98.1992 24.5137 98.5977 23.3652 98.5977H7.01758C5.89258 98.5977 4.93164 98.1992 4.13477 97.4023C3.33789 96.6055 2.93945 95.6445 2.93945 94.5195V69.9805C2.93945 68.8555 3.33789 67.8945 4.13477 67.0977C4.93164 66.3008 5.89258 65.9023 7.01758 65.9023H23.3652ZM8.63477 72.4414V92.0586C8.63477 92.293 8.7168 92.4922 8.88086 92.6562C9.04492 92.8203 9.24414 92.9023 9.47852 92.9023H20.9395C21.1504 92.9023 21.3379 92.8203 21.502 92.6562C21.666 92.4922 21.748 92.293 21.748 92.0586V72.4414C21.748 72.207 21.666 72.0078 21.502 71.8438C21.3379 71.6797 21.1504 71.5977 20.9395 71.5977H9.47852C9.24414 71.5977 9.04492 71.6797 8.88086 71.8438C8.7168 72.0078 8.63477 72.207 8.63477 72.4414ZM55.2871 93.7109V97.7891C55.2871 98.0234 55.2051 98.2109 55.041 98.3516C54.877 98.5156 54.6777 98.5977 54.4434 98.5977H31.5566C31.3223 98.5977 31.123 98.5156 30.959 98.3516C30.8184 98.2109 30.748 98.0234 30.748 97.7891V83.9023C30.748 82.7539 31.1465 81.7812 31.9434 80.9844C32.7402 80.1875 33.7012 79.7891 34.8262 79.7891H48.748C48.959 79.7891 49.1465 79.7188 49.3105 79.5781C49.4746 79.4141 49.5566 79.2148 49.5566 78.9805V72.4414C49.5566 72.207 49.4746 72.0078 49.3105 71.8438C49.1465 71.6797 48.959 71.5977 48.748 71.5977H31.5566C31.3223 71.5977 31.123 71.5273 30.959 71.3867C30.8184 71.2227 30.748 71.0234 30.748 70.7891V66.7109C30.748 66.4766 30.8184 66.2891 30.959 66.1484C31.123 65.9844 31.3223 65.9023 31.5566 65.9023H51.1738C52.3223 65.9023 53.2949 66.3008 54.0918 67.0977C54.8887 67.8945 55.2871 68.8555 55.2871 69.9805V80.5977C55.2871 81.7461 54.8887 82.7188 54.0918 83.5156C53.2949 84.3125 52.3223 84.7109 51.1738 84.7109H37.2871C37.0527 84.7109 36.8535 84.793 36.6895 84.957C36.5254 85.0977 36.4434 85.2852 36.4434 85.5195V92.0586C36.4434 92.293 36.5254 92.4922 36.6895 92.6562C36.8535 92.8203 37.0527 92.9023 37.2871 92.9023H54.4434C54.6777 92.9023 54.877 92.9844 55.041 93.1484C55.2051 93.2891 55.2871 93.4766 55.2871 93.7109ZM78.9824 65.9023C80.1309 65.9023 81.1035 66.3008 81.9004 67.0977C82.6973 67.8945 83.0957 68.8555 83.0957 69.9805V94.5195C83.0957 95.6445 82.6973 96.6055 81.9004 97.4023C81.1035 98.1992 80.1309 98.5977 78.9824 98.5977H59.3652C59.1309 98.5977 58.9316 98.5156 58.7676 98.3516C58.627 98.2109 58.5566 98.0234 58.5566 97.7891V93.7109C58.5566 93.4766 58.627 93.2891 58.7676 93.1484C58.9316 92.9844 59.1309 92.9023 59.3652 92.9023H76.5566C76.7676 92.9023 76.9551 92.8203 77.1191 92.6562C77.2832 92.4922 77.3652 92.293 77.3652 92.0586V85.5195C77.3652 85.2852 77.2832 85.0977 77.1191 84.957C76.9551 84.793 76.7676 84.7109 76.5566 84.7109H62.6348C61.5098 84.7109 60.5488 84.3125 59.752 83.5156C58.9551 82.7188 58.5566 81.7461 58.5566 80.5977V69.9805C58.5566 68.8555 58.9551 67.8945 59.752 67.0977C60.5488 66.3008 61.5098 65.9023 62.6348 65.9023H78.9824ZM77.3652 78.9805V72.4414C77.3652 72.207 77.2832 72.0078 77.1191 71.8438C76.9551 71.6797 76.7676 71.5977 76.5566 71.5977H65.0957C64.8613 71.5977 64.6621 71.6797 64.498 71.8438C64.334 72.0078 64.252 72.207 64.252 72.4414V78.9805C64.252 79.2148 64.334 79.4141 64.498 79.5781C64.6621 79.7188 64.8613 79.7891 65.0957 79.7891H76.5566C76.7676 79.7891 76.9551 79.7188 77.1191 79.5781C77.2832 79.4141 77.3652 79.2148 77.3652 78.9805Z"
				fill="#456778"
			/> -->
		</svg>

		<!-- Missile Icon -->
		<svg id="icon" viewBox="0 0 42 54" fill="none" xmlns="http://www.w3.org/2000/svg">
			<g
				class="missile"
				class:empty-fill={status === AmmoState.Empty}
				class:some-fill={status !== AmmoState.Empty}
			>
				<path d="M21 0C16.0294 0 12 4.02944 12 9V18H30V9C30 4.02944 25.9706 0 21 0Z" />
				<path d="M13 21V35H29V21H13Z" />
				<path d="M0 49V54H8V41L0 49Z" />
				<path d="M42 49V54H34V41L42 49Z" />
				<path d="M11 38V54H19V42H23V54H31V38H11Z" />
			</g>
		</svg>
		<!-- Slider -->
		<svg
			id="slider"
			viewBox="0 0 1080 1080"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
			style="rotate: {ammoRotation}deg"
		>
			<!-- Arrow -->
			<path
				class="arrow"
				class:empty-fill={status === AmmoState.Empty}
				class:some-fill={status !== AmmoState.Empty}
				d="M990 520V527.686L974.62 540L990 552.312V560L965 540L990 520Z"
			/>
			<path
				class="arrow"
				class:empty-fill={status === AmmoState.Empty}
				class:some-fill={status !== AmmoState.Empty}
				d="M990 535.372L984.22 540L990 544.628V535.372Z"
			/>
			<!-- Message -->
			<defs>
				<path
					id="text-path-ammo"
					d="M540,115C595.812,115 651.077,125.993 702.64,147.351C754.204,168.709 801.055,200.015 840.52,239.48C879.985,278.945 911.291,325.796 932.649,377.36C954.007,428.923 965,484.188 965,540"
					stroke="orange"
				/>
			</defs>
			<text>
				<textPath
					id="message"
					class:warning-text={status === AmmoState.Low}
					class:empty-text={status === AmmoState.Empty}
					href="#text-path-ammo"
					startOffset="95%"
					>{message}
				</textPath>
			</text>
		</svg>
	</div>
</div>

<!-- STYLE -->
<style>
	#frame {
		position: absolute;
		height: 100%;
		aspect-ratio: 1920/1080;
		left: 50%;
		top: 50%;
		translate: -50% -50%;
	}

	#ammo-counter {
		position: absolute;
		width: calc(1080% / 1920 * 100);
		height: 100%;
		left: 50%;
		top: 50%;
		translate: -50% -50%;
	}

	#bar {
		position: absolute;
		height: calc(450% / 1080 * 100);
		right: calc(115% / 1080 * 100);
		top: calc(315% / 1080 * 100);
	}

	#icon {
		position: absolute;
		height: calc(54% / 1080 * 100);
		right: calc(31% / 1080 * 100);
		top: 50%;
		translate: 0 -50%;
	}

	#slider {
		position: absolute;
		height: 100%;
		left: 50%;
		top: 50%;
		translate: -50% -50%;
	}

	.line {
		stroke-width: 3;
	}

	.numbers-container {
		position: absolute;
		height: calc(108% / 1080 * 100);
		left: 100.5%;
		top: 50%;
		translate: 0 -50%;
	}

	.numbers {
		font-family: 'Metroid';
		font-weight: 100;
		fill: #a3e7f5;
		font-size: 270%;
		dominant-baseline: central;
		text-anchor: middle;
	}

	.arrow,
	.missile {
		fill-opacity: 90%;
	}

	#message {
		font-family: 'Metroid';
		font-size: 200%;
        font-weight: 100;
		text-anchor: end;
	}

	.empty-fill {
		fill: hsl(190, 30%, 50%);
		fill-opacity: 50%;
	}

	.some-fill {
		fill: hsl(190, 80%, 80%);
	}

	.empty-stroke {
		stroke: hsl(190, 30%, 50%);
		stroke-opacity: 50%;
	}

	.some-stroke {
		stroke: hsl(190, 80%, 80%);
	}

	.warning-text {
		fill: #e5c31a;
		stroke: #998000;
		animation: low-ammo-flash 0.5s linear 5 forwards;
	}

    .empty-text {
		fill: #e5631a;
		stroke: #993300;
		animation: empty-flash 0.5s linear 5 forwards;
	}

	@keyframes low-ammo-flash {
		0% {
			opacity: 0;
		}
		50% {
			opacity: 1;
		}
		100% {
			opacity: 0;
		}
	}

	@keyframes empty-flash {
		0% {
			opacity: 0;
		}
		50% {
			opacity: 1;
		}
		100% {
			opacity: 0;
		}
	}
</style>
